{"version":3,"sources":["uni-app:///main.js","webpack:////Users/ChenZhiluo/Desktop/msc/scenic/wx_front/pages/map/map.vue?15bd","webpack:////Users/ChenZhiluo/Desktop/msc/scenic/wx_front/pages/map/map.vue?4204","webpack:////Users/ChenZhiluo/Desktop/msc/scenic/wx_front/pages/map/map.vue?7450","webpack:////Users/ChenZhiluo/Desktop/msc/scenic/wx_front/pages/map/map.vue?ac02","uni-app:///pages/map/map.vue","webpack:////Users/ChenZhiluo/Desktop/msc/scenic/wx_front/pages/map/map.vue?2c37","webpack:////Users/ChenZhiluo/Desktop/msc/scenic/wx_front/pages/map/map.vue?77d0"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","components","NavBar","data","global_scenic_id","resource_url","scenic_info","title","latitude","longitude","scale","attractions","markers","showInfo","selectedAttraction","isChecked","selectedDateTime","distanceToAttraction","onShow","computed","userLocation","methods","fetchGlobalScenicId","markChecked","addFootprint","uni","url","method","user","scenic","attraction","check_in_time","manual_check","success","console","fail","handleChange","fetchScenic","getAttractions","renderMarkers","id","name","width","height","showAttractionInfo","value","unit","calculateDistance","Math","distanceValue","distanceUnit","deg2rad","navto_detail","navigateToNavigationPage","address","beforeRouteEnter","next","vm"],"mappings":";;;;;;;;;;;;;AAAA;AAGA;AACA;AAHA;AACAA,EAAE,CAACC,iCAAiC,GAAGC,mBAAmB;AAG1DC,UAAU,CAACC,YAAI,CAAC,C;;;;;;;;;;;;;ACLhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAA4H;AAC5H;AACuD;AACL;AACqC;;;AAGvF;AACmN;AACnN,gBAAgB,iNAAU;AAC1B,EAAE,yEAAM;AACR,EAAE,0FAAM;AACR,EAAE,mGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,8FAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,aAAa,uPAEN;AACP,KAAK;AACL;AACA,aAAa,sTAEN;AACP,KAAK;AACL;AACA,aAAa,8OAEN;AACP,KAAK;AACL;AACA,aAAa,gQAEN;AACP,KAAK;AACL;AACA,aAAa,qRAEN;AACP,KAAK;AACL;AACA,aAAa,gZAEN;AACP,KAAK;AACL;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;AC1DA;AAAA;AAAA;AAAA;AAAg1B,CAAgB,iyBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;ACgEp2B;AAEA;AAAA;AAAA;EAAA;IAAA;EAAA;AAAA;AAAA,eACA;EACAC;IACAC;EACA;EACAC;IACA;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MAAA;MACAC;MACAC;MACA;MACAC;IACA;EACA;EACAC;IACA;IACA;IACA;IACA;EACA;EACAC,4BACA;IACAC;MAAA;IAAA;EACA,GACA;EACAC;IACAC;MACA;IACA;IACAC;MACA;MACA;IACA;IACAC;MAAA;MACA;MACAC;QACAC;QACAC;QACAxB;UACAyB;UACAC;UACAC;UACAC;UAAA;UACAC;QACA;;QACAC;UACA;UACAC;UACA;UACA;QACA;QACAC;UACA;UACAD;QACA;MACA;IACA;IACAE;MACA;MACAF;MACA;IACA;IACAG;MAAA;MACAZ;QACAC;QACAC;QACAM;UACA;YACA;YACA;YACA;YACA;YACA;UACA;YACAC;UACA;QACA;MACA;IACA;IACA;IACAI;MAAA;MACAb;QACAC;QACAC;QACAM;UACA;YACA;YACA;YACA;YACA;UACA;YACAC;UACA;QACA;QACAC;UACAD;QACA;MACA;IACA;IACA;IACAK;MACA;QAAA;UACAC;UACAhC;UACAC;UACAgC;UACAC;UAAA;UACAC;QACA;MAAA;;MACA;IACA;IACA;IACAC;MACA;MACA;QAAA;MAAA;MACAV;MACA;QACA;QACA;QACA;QACA;QACA,4BAGA,gFACApB;UAHA+B;UACAC;QAGA;QACAZ;QACA;QACA;QACA;QACA;QACA;MACA;IACA;IACA;IACAa;MACA;MACA;MACA;MACA,QACAC,0CACAA,8DACAA;MACA;MACA;MACA;MACA;MACA;QACAC;QACAC;MACA;;MAEA;MACA;QACAL;QACAC;MACA;IACA;IACAK;MACA;IACA;IACA;IACAC;MACAlB;MACAT;QACAC;MACA;IACA;IACA;IACA2B;MACA;MACA5B;QACAjB;QACAC;QACAgC;QACAa;QACArB;UACAC;QACA;QACAC;UACAD;QACA;MACA;IACA;EACA;EACAqB;IACAC;MACAC;MACAA;MACAA;IACA;EACA;AACA;AAAA,2B;;;;;;;;;;;;;AC7QA;AAAA;AAAA;AAAA;AAA2tC,CAAgB,snCAAG,EAAC,C;;;;;;;;;;;ACA/uC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/map/map.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/map/map.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./map.vue?vue&type=template&id=0b31f540&scoped=true&\"\nvar renderjs\nimport script from \"./map.vue?vue&type=script&lang=js&\"\nexport * from \"./map.vue?vue&type=script&lang=js&\"\nimport style0 from \"./map.vue?vue&type=style&index=0&id=0b31f540&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"0b31f540\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/map/map.vue\"\nexport default component.exports","export * from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./map.vue?vue&type=template&id=0b31f540&scoped=true&\"","var components\ntry {\n  components = {\n    uniCard: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-card/components/uni-card/uni-card\" */ \"@/uni_modules/uni-card/components/uni-card/uni-card.vue\"\n      )\n    },\n    uniIcons: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-icons/components/uni-icons/uni-icons\" */ \"@/uni_modules/uni-icons/components/uni-icons/uni-icons.vue\"\n      )\n    },\n    uniTag: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-tag/components/uni-tag/uni-tag\" */ \"@/uni_modules/uni-tag/components/uni-tag/uni-tag.vue\"\n      )\n    },\n    uniPopup: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-popup/components/uni-popup/uni-popup\" */ \"@/uni_modules/uni-popup/components/uni-popup/uni-popup.vue\"\n      )\n    },\n    uLine: function () {\n      return import(\n        /* webpackChunkName: \"node-modules/uview-ui/components/u-line/u-line\" */ \"uview-ui/components/u-line/u-line.vue\"\n      )\n    },\n    uniDatetimePicker: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-datetime-picker/components/uni-datetime-picker/uni-datetime-picker\" */ \"@/uni_modules/uni-datetime-picker/components/uni-datetime-picker/uni-datetime-picker.vue\"\n      )\n    },\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./map.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./map.vue?vue&type=script&lang=js&\"","<template>\r\n\t<view>\r\n\t\t<NavBar>\r\n\t\t\t<template slot=\"title\">\r\n\t\t\t\t<view>地图导览</view>\r\n\t\t\t</template>\r\n\t\t</NavBar>\r\n\t\t<view class=\"container map-container\">\r\n\t\t\t<map class=\"map\" show-location :scale=\"scale\" :longitude=\"longitude\" :latitude=\"latitude\" :markers=\"markers\"\r\n\t\t\t\t@markertap=\"showAttractionInfo\">\r\n\t\t\t</map>\r\n\t\t\t<canvas canvas-id=\"heatmapCanvas\" class=\"heatmap-canvas\"\r\n\t\t\t\tstyle=\"position: absolute; top: 0; left: 0;\"></canvas>\r\n\t\t\t<view v-if=\"showInfo\" class=\"attraction-info\">\r\n\t\t\t\t<uni-card>\r\n\t\t\t\t\t<template v-slot:title>\r\n\t\t\t\t\t\t<view class=\"select_attraction\">\r\n\t\t\t\t\t\t\t<image class=\"attraction-image\" :src=\"selectedAttraction.image\" mode=\"aspectFill\" />\r\n\t\t\t\t\t\t\t<view class=\"select_info\">\r\n\t\t\t\t\t\t\t\t<view class=\"name_info\">\r\n\t\t\t\t\t\t\t\t\t<text style=\"color: black;\">{{ selectedAttraction.attraction_name }}</text>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<view class=\"other-info\">\r\n\t\t\t\t\t\t\t\t\t<uni-icons type=\"paperplane-filled\" size=\"16\" color=\"#a9dbd0\"></uni-icons>\r\n\t\t\t\t\t\t\t\t\t<text>{{ distanceToAttraction }}</text>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t\t<view class=\"other-info\">\r\n\t\t\t\t\t\t\t\t\t<uni-icons type=\"location-filled\" size=\"16\" color=\"#a9dbd0\"></uni-icons>\r\n\t\t\t\t\t\t\t\t\t<text> {{selectedAttraction.address}}</text>\r\n\t\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</template>\r\n\t\t\t\t\t<view class=\"select_nav\">\r\n\t\t\t\t\t\t<view>\r\n\t\t\t\t\t\t\t<uni-tag text=\"查看详情\" circle=\"true\" type=\"warning\" style=\"margin-left: 15px;\"\r\n\t\t\t\t\t\t\t\t@click=\"navto_detail\"></uni-tag>\r\n\t\t\t\t\t\t\t<uni-tag v-if=\"!isChecked\" text=\"标记为已打卡\" circle=\"true\" type=\"success\"\r\n\t\t\t\t\t\t\t\tstyle=\"margin-left: 15px;\" @click=\"markChecked\"></uni-tag>\r\n\t\t\t\t\t\t\t<uni-tag v-if=\"isChecked\" text=\"已打卡\" circle=\"true\" type=\"success\"\r\n\t\t\t\t\t\t\t\tstyle=\"margin-left: 15px;\"></uni-tag>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t\t<view class=\"select_nav_box\" @click=\"navigateToNavigationPage(selectedAttraction)\">\r\n\t\t\t\t\t\t\t<uni-icons type=\"paperplane-filled\" size=\"16\" color=\"#a9dbd0\"></uni-icons>\r\n\t\t\t\t\t\t\t<text>导航</text>\r\n\t\t\t\t\t\t</view>\r\n\t\t\t\t\t</view>\r\n\t\t\t\t</uni-card>\r\n\t\t\t</view>\r\n\r\n\t\t</view>\r\n\t\t<uni-popup ref=\"popup\" type=\"bottom\" background-color=\"#fff\" border-radius=\"10px 10px 0 0\">\r\n\t\t\t<view class=\"time-picker\">\r\n\t\t\t\t<text>请选择打卡此景点的时间</text>\r\n\t\t\t\t<u-line margin=\"10px 0\" color=\"white\" />\r\n\t\t\t\t<uni-datetime-picker type=\"datetime\" returnType=\"date\" v-model=\"selectedDateTime\"\r\n\t\t\t\t\t@change=\"handleChange\" />\r\n\t\t\t</view>\r\n\t\t</uni-popup>\r\n\t</view>\r\n</template>\r\n\r\n<script>\r\n\timport NavBar from \"../../components/NavBar.vue\";\r\n\timport {\r\n\t\tmapState\r\n\t} from 'vuex';\r\n\texport default {\r\n\t\tcomponents: {\r\n\t\t\tNavBar\r\n\t\t},\r\n\t\tdata() {\r\n\t\t\treturn {\r\n\t\t\t\tglobal_scenic_id: null,\r\n\t\t\t\tresource_url: getApp().globalData.resourceURL,\r\n\t\t\t\tscenic_info: [],\r\n\t\t\t\ttitle: 'map',\r\n\t\t\t\tlatitude: 30.244917207446186,\r\n\t\t\t\tlongitude: 120.14621247265623,\r\n\t\t\t\tscale: 13.8,\r\n\t\t\t\tattractions: [], // 存储从后端获取的景点数据\r\n\t\t\t\tmarkers: [], // 地图标记点\r\n\t\t\t\tshowInfo: false, // 是否显示景点信息卡片\r\n\t\t\t\tselectedAttraction: {}, // 当前选中的景点信息\r\n\t\t\t\tisChecked: false,\r\n\t\t\t\tselectedDateTime: '',\r\n\t\t\t\t// userLocation: {}, // 用户当前位置\r\n\t\t\t\tdistanceToAttraction: null,\r\n\t\t\t};\r\n\t\t},\r\n\t\tonShow() {\r\n\t\t\tthis.fetchGlobalScenicId();\r\n\t\t\tthis.fetchScenic();\r\n\t\t\t// 在页面加载时获取景点数据\r\n\t\t\tthis.getAttractions();\r\n\t\t},\r\n\t\tcomputed: {\r\n\t\t\t...mapState({\r\n\t\t\t\tuserLocation: state => state.userLocation\r\n\t\t\t})\r\n\t\t},\r\n\t\tmethods: {\r\n\t\t\tfetchGlobalScenicId() {\r\n\t\t\t\tthis.global_scenic_id = getApp().globalData.global_scenic_id;\r\n\t\t\t},\r\n\t\t\tmarkChecked() {\r\n\t\t\t\t// const now = new Date();\r\n\t\t\t\tthis.$refs.popup.open()\r\n\t\t\t},\r\n\t\t\taddFootprint(selectedDateTime) {\r\n\t\t\t\t// 假设这里调用了后端接口，将景点加入用户的历史足迹信息中，并且设置 manual_check 为 true\r\n\t\t\t\tuni.request({\r\n\t\t\t\t\turl: `${this.resource_url}footprint/`,\r\n\t\t\t\t\tmethod: 'POST',\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tuser: 1,\r\n\t\t\t\t\t\tscenic: this.global_scenic_id,\r\n\t\t\t\t\t\tattraction: this.selectedAttraction.attraction_id,\r\n\t\t\t\t\t\tcheck_in_time: selectedDateTime, // 用户选择的日期时间\r\n\t\t\t\t\t\tmanual_check: true // 设置 manual_check 为 true\r\n\t\t\t\t\t},\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\t// 成功添加足迹\r\n\t\t\t\t\t\tconsole.log('足迹添加成功');\r\n\t\t\t\t\t\tthis.$refs.popup.close();\r\n\t\t\t\t\t\tthis.isChecked = true;\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\t// 处理错误\r\n\t\t\t\t\t\tconsole.error('足迹添加失败:', err);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\thandleChange(event) {\r\n\t\t\t\t// 选择日期时间后的处理逻辑\r\n\t\t\t\tconsole.log(this.selectedDateTime);\r\n\t\t\t\tthis.addFootprint(this.selectedDateTime); // 标记打卡后添加足迹\r\n\t\t\t},\r\n\t\t\tfetchScenic() {\r\n\t\t\t\tuni.request({\r\n\t\t\t\t\turl: `http://localhost:8000/scenic/${this.global_scenic_id}`,\r\n\t\t\t\t\tmethod: 'GET',\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tif (res.statusCode === 200) {\r\n\t\t\t\t\t\t\t// 将从后端获取的数据存储到attractions中\r\n\t\t\t\t\t\t\tthis.scenic_info = res.data;\r\n\t\t\t\t\t\t\tthis.longitude = res.data.scenic_lng;\r\n\t\t\t\t\t\t\tthis.latitude = res.data.scenic_lat;\r\n\t\t\t\t\t\t\tthis.scale = res.data.scale;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tconsole.error('Failed to fetch attractions data');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 从后端获取景点数据\r\n\t\t\tgetAttractions() {\r\n\t\t\t\tuni.request({\r\n\t\t\t\t\turl: `http://localhost:8000/attraction?scenic=${this.global_scenic_id}`,\r\n\t\t\t\t\tmethod: 'GET',\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tif (res.statusCode === 200) {\r\n\t\t\t\t\t\t\t// 将从后端获取的数据存储到attractions中\r\n\t\t\t\t\t\t\tthis.attractions = res.data.results;\r\n\t\t\t\t\t\t\t// 渲染地图标记点\r\n\t\t\t\t\t\t\tthis.renderMarkers();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tconsole.error('Failed to fetch attractions data');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (err) => {\r\n\t\t\t\t\t\tconsole.error('Failed to fetch attractions data:', err);\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\t// 渲染地图标记点\r\n\t\t\trenderMarkers() {\r\n\t\t\t\tconst markers = this.attractions.map((attraction) => ({\r\n\t\t\t\t\tid: attraction.attraction_id,\r\n\t\t\t\t\tlatitude: attraction.attraction_lat,\r\n\t\t\t\t\tlongitude: attraction.attraction_lng,\r\n\t\t\t\t\tname: attraction.attraction_name,\r\n\t\t\t\t\twidth: 22, // 设置标记宽度\r\n\t\t\t\t\theight: 30, // 设置标记高度\r\n\t\t\t\t}));\r\n\t\t\t\tthis.markers = markers;\r\n\t\t\t},\r\n\t\t\t// 显示景点信息卡片\r\n\t\t\tshowAttractionInfo(e) {\r\n\t\t\t\tconst markerId = e.markerId;\r\n\t\t\t\tconst selectedAttraction = this.attractions.find(attraction => attraction.attraction_id === markerId);\r\n\t\t\t\tconsole.log(this.userLocation);\r\n\t\t\t\tif (selectedAttraction) {\r\n\t\t\t\t\t// 计算距离\r\n\t\t\t\t\t// const distance = this.calculateDistance(this.userLocation.latitude, this.userLocation.longitude,\r\n\t\t\t\t\t// \tselectedAttraction.attraction_lat, selectedAttraction.attraction_lng);\r\n\t\t\t\t\t// console.log(distance);\r\n\t\t\t\t\tconst {\r\n\t\t\t\t\t\tvalue,\r\n\t\t\t\t\t\tunit\r\n\t\t\t\t\t} = this.calculateDistance(this.userLocation.latitude, this.userLocation.longitude,\r\n\t\t\t\t\t\tselectedAttraction.attraction_lat, selectedAttraction.attraction_lng);\r\n\t\t\t\t\tthis.distanceToAttraction = `距您约 ${value.toFixed(2)} ${unit}`;\r\n\t\t\t\t\tconsole.log(this.distanceToAttraction);\r\n\t\t\t\t\t// 设置选中的景点信息\r\n\t\t\t\t\tthis.selectedAttraction = selectedAttraction;\r\n\t\t\t\t\t// 显示信息卡片\r\n\t\t\t\t\tthis.showInfo = true;\r\n\t\t\t\t\tthis.isChecked = false;\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\t// 计算距离\r\n\t\t\tcalculateDistance(lat1, lon1, lat2, lon2) {\r\n\t\t\t\tvar R = 6371; // 地球半径，单位：千米  \r\n\t\t\t\tvar dLat = this.deg2rad(lat2 - lat1); // 纬度差转换为弧度  \r\n\t\t\t\tvar dLon = this.deg2rad(lon2 - lon1); // 经度差转换为弧度  \r\n\t\t\t\tvar a =\r\n\t\t\t\t\tMath.sin(dLat / 2) * Math.sin(dLat / 2) +\r\n\t\t\t\t\tMath.cos(this.deg2rad(lat1)) * Math.cos(this.deg2rad(lat2)) *\r\n\t\t\t\t\tMath.sin(dLon / 2) * Math.sin(dLon / 2);\r\n\t\t\t\tvar c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\r\n\t\t\t\tvar distanceKm = R * c; // 距离，单位：千米  \r\n\t\t\t\tvar distanceUnit = 'km';\r\n\t\t\t\tvar distanceValue = distanceKm;\r\n\t\t\t\tif (distanceKm < 1) {\r\n\t\t\t\t\tdistanceValue = distanceKm * 1000; // 转换为米  \r\n\t\t\t\t\tdistanceUnit = 'm';\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// 返回包含距离值和单位的对象，或者仅返回距离值（如果需要）  \r\n\t\t\t\treturn {\r\n\t\t\t\t\tvalue: distanceValue,\r\n\t\t\t\t\tunit: distanceUnit\r\n\t\t\t\t};\r\n\t\t\t},\r\n\t\t\tdeg2rad(deg) {\r\n\t\t\t\treturn deg * (Math.PI / 180);\r\n\t\t\t},\r\n\t\t\t// 跳转至景点详细信息页面\r\n\t\t\tnavto_detail() {\r\n\t\t\t\tconsole.log('Navigate to ' + this.selectedAttraction.attraction_id);\r\n\t\t\t\tuni.navigateTo({\r\n\t\t\t\t\turl: '/pages/detail/detail?attraction_id=' + this.selectedAttraction.attraction_id,\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t\t// 跳转至导航页面\r\n\t\t\tnavigateToNavigationPage(selectedAttraction) {\r\n\t\t\t\t// 实现地图导航的逻辑\r\n\t\t\t\tuni.openLocation({\r\n\t\t\t\t\tlatitude: selectedAttraction.attraction_lat,\r\n\t\t\t\t\tlongitude: selectedAttraction.attraction_lng,\r\n\t\t\t\t\tname: selectedAttraction.attraction_name,\r\n\t\t\t\t\taddress: selectedAttraction.address,\r\n\t\t\t\t\tsuccess: (res) => {\r\n\t\t\t\t\t\tconsole.log(res)\r\n\t\t\t\t\t},\r\n\t\t\t\t\tfail: (res) => {\r\n\t\t\t\t\t\tconsole.log(res)\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t},\r\n\t\t},\r\n\t\tbeforeRouteEnter(to, from, next) {\r\n\t\t\tnext(vm => {\r\n\t\t\t\tvm.fetchGlobalScenicId(); // 在路由进入前获取一次 global_scenic_id\r\n\t\t\t\tvm.fetchScenic(); // 在路由进入前获取景点信息\r\n\t\t\t\tvm.getAttractions(); // 在路由进入前获取景点数据\r\n\t\t\t});\r\n\t\t},\r\n\t};\r\n</script>\r\n\r\n<style scoped>\r\n\t.container {\r\n\t\twidth: 100vw;\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: center;\r\n\t}\r\n\r\n\t.map-container {\r\n\t\tposition: relative;\r\n\t\theight: 100vh;\r\n\t\t/* 根据需求调整容器宽度 */\r\n\t\toverflow: hidden;\r\n\t}\r\n\r\n\t.map {\r\n\t\tposition: absolute;\r\n\t\twidth: 100%;\r\n\t\theight: 100%;\r\n\t}\r\n\r\n\t.attraction-image {\r\n\t\twidth: 60px;\r\n\t\theight: 60px;\r\n\t\tmargin-right: 10px;\r\n\t\tborder-radius: 10px;\r\n\t}\r\n\r\n\t.time-picker {\r\n\t\twidth: 300px;\r\n\t\theight: 100px;\r\n\t\tmargin-top: 20px;\r\n\t\tmargin-left: 50px;\r\n\t}\r\n\r\n\t.attraction-info {\r\n\t\tposition: absolute;\r\n\t\twidth: 400px;\r\n\t\tborder-radius: 10rpx;\r\n\t\tbottom: 100px;\r\n\t\tz-index: 10;\r\n\t}\r\n\r\n\t.select_attraction {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tpadding: 10px;\r\n\t}\r\n\r\n\t.other-info {\r\n\t\tfont-size: 12px;\r\n\t\tcolor: gray;\r\n\t}\r\n\r\n\t.select_nav {\r\n\t\tdisplay: flex;\r\n\t\tjustify-content: space-between;\r\n\t\talign-items: center;\r\n\t}\r\n\r\n\t.select_nav_box {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tpadding: 0px 10px 0px 8px;\r\n\t\tborder-radius: 20px;\r\n\t\tborder: 0.5px solid #a9dbd0;\r\n\t\tcolor: #a9dbd0;\r\n\t\tfont-size: 12px;\r\n\t}\r\n\r\n\t.select_nav_box text {\r\n\t\tcolor: #a9dbd0;\r\n\t\tfont-size: 12px;\r\n\t}\r\n</style>\r\n","import mod from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./map.vue?vue&type=style&index=0&id=0b31f540&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./map.vue?vue&type=style&index=0&id=0b31f540&scoped=true&lang=css&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1744710971553\n      var cssReload = require(\"/Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}